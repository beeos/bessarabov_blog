# Новая версия Perl библиотеки Moment. Метод для получения номера дня недели.

date_time: 2015-05-01 06:46:13 MSK

У меня есть простая библиотека для работы со временем [Moment](cpan). Я ее
использую в своих разных проектах. Появилась необходимость из даты получить
номер дня недели. Моя библиотека не умела так делать, поэтому в проекте
пришлось написать так:

    my $weekday_number = get_weekday_number($moment);

    sub get_weekday_number {
        my ($moment) = @_;

        my %n = (
            monday => 1,
            tuesday => 2,
            wednesday => 3,
            thursday => 4,
            friday => 5,
            saturday => 6,
            sunday => 7,
        );

        return $n{ $moment->get_weekday_name() };
    }

Это, вроде как, работает, но выглядит плохо — явно чувствуется что это
задача, которая должна решатся в библиотеке. Плохо копипастить такой код
в каждом проекте, в котором понадобится выяснить номер для недели. Эта
штука не обложена тестами, вроде ошибки тут нет, но всегда приятнее
использовать кусок кода, про который знаешь, что он как-то тестируется.

Но есть вопрос — что считать первым днем недели? Тут в России первый день
недели — это понедельник, и стандарт [ISO 8601][iso] тоже использует
понедельник для первого дня недели, но, например, в США, первый день недели —
это воскресенье. [Википедия пишет][wikipedia] что еще бывает суббота в
качестве первого дня недели.

Я хочу чтобы моя библиотека [Moment][moment] могла быть легко использована
вне зависимости от того, какая система нумерации недель принята.

Поэтому я написал метод, которому нужно явно сказать что считать первым днем
недели:

    my $weekday_number = $moment->get_weekday_number( first_day => 'monday' );

Судя по [википедии][wikipedia] в качестве first_day стоит использовать только
три дня: saturday, sunday, monday — только эти дни являются первыми днями
недели в разных странах, но для консистентности я сделал возможность
указывать в качестве 'first_day' любой день недели, возможно, где-нибудь
это может пригодится (хотя я не могу представить ситуацию, где это может
быть использовано).

Метод get_weekday_number() появлся в [версии 1.2.0](https://metacpan.org/release/BESSARABV/Moment-1.2.0).
Вот [комит с реализацией](https://github.com/bessarabov/Moment/commit/98be50c2dddae23ea05ddca1c40576e6ef075886) —
большоая часть изменения — это тесты и документация, а в самом методе
большую часть кода занимает обработака ошибок. Еще интересный момент — для
решений этой задачи я написал маленький скрипт, который [выдает рандомные
даты][rand] для всех 7 дней недели — именно эти даты я использую в тесте.

 [cpan]: https://metacpan.org/pod/Moment
 [wikipedia]: http://en.wikipedia.org/wiki/Names_of_the_days_of_the_week#Numbered_days_of_the_week
 [iso]: http://en.wikipedia.org/wiki/ISO_8601#Week_dates
 [rand]: https://gist.github.com/bessarabov/692476d1c7de5f5f09ec
